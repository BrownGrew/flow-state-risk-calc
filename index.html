<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow State Elastic v3.1</title>
    <style>
        /* CSS remains consistent for a clean, professional dark theme */
        body { font-family: 'Inter', sans-serif; background-color: #0f0f0f; color: #ffffff; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; min-height: 100vh; }
        h2 { color: #555; letter-spacing: 2px; text-transform: uppercase; font-size: 14px; margin-bottom: 25px; }
        .input-group { width: 100%; max-width: 400px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-size: 12px; color: #888; font-weight: bold; }
        input { width: 100%; padding: 14px; background-color: #1a1a1a; border: 1px solid #333; border-radius: 10px; color: white; font-size: 16px; outline: none; box-sizing: border-box; }
        input:focus { border-color: #00bcd4; }
        button { width: 100%; max-width: 400px; padding: 16px; background-color: #00bcd4; color: #121212; border: none; border-radius: 10px; font-size: 16px; font-weight: 800; cursor: pointer; margin-top: 10px; text-transform: uppercase; }
        #result-card { margin-top: 25px; width: 100%; max-width: 400px; padding: 25px; border-radius: 15px; text-align: center; display: none; box-sizing: border-box; }
        .state-label { font-size: 42px; font-weight: 900; margin: 0; line-height: 1; }
        .risk-label { font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 25px; margin-top: 10px; }
        .data-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; }
        .data-value { font-size: 18px; font-weight: bold; }
        
        .peak { background: linear-gradient(135deg, #198754, #146c43); }
        .flow { background: linear-gradient(135deg, #0dcaf0, #0aa2c0); }
        .neutral { background: #2c2c2c; }
        .reset { background: #ffc107; color: #000; }
        .reset .data-value, .reset .data-title, .reset .risk-label { color: #000; }
        .lockdown { background: #dc3545; }
        .stop-trading { background: #000; border: 4px solid #ff0000; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,0,0,0.4); } 70% { box-shadow: 0 0 0 15px rgba(255,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(255,0,0,0); } }
    </style>
</head>
<body>

    <h2>Flow State Manager v3.1</h2>

    <div class="input-group">
        <label>Starting Balance ($)</label>
        <input type="number" id="startBal" placeholder="100000">
    </div>

    <div class="input-group">
        <label>Current Balance ($)</label>
        <input type="number" id="currBal" placeholder="98500">
    </div>

    <div class="input-group">
        <label>Max Drawdown Limit (%)</label>
        <input type="number" id="maxDD" value="10" step="0.1">
    </div>

    <button onclick="calculateRisk()">Calculate Elastic System</button>

    <div id="result-card">
        <h1 id="stateText" class="state-label"></h1>
        <p id="focusText" class="risk-label"></p>

        <div class="data-row"><span class="data-title">Current PnL</span><span id="pnlText" class="data-value"></span></div>
        <div class="data-row"><span class="data-title">Risk Percent</span><span id="riskPerText" class="data-value"></span></div>
        <div class="data-row" style="border:none; margin-top: 10px;"><span class="data-title">Risk Amount</span><span id="riskAmtText" class="data-value" style="font-size: 28px; color: #fff;"></span></div>
    </div>

    <script>
        window.onload = function() {
            if(localStorage.getItem('userMaxDD')) document.getElementById('maxDD').value = localStorage.getItem('userMaxDD');
            if(localStorage.getItem('userStartBal')) document.getElementById('startBal').value = localStorage.getItem('userStartBal');
        };

        function calculateRisk() {
            let start = parseFloat(document.getElementById('startBal').value);
            let current = parseFloat(document.getElementById('currBal').value);
            let limitDD = parseFloat(document.getElementById('maxDD').value);

            localStorage.setItem('userMaxDD', limitDD);
            localStorage.setItem('userStartBal', start);

            if (isNaN(start) || isNaN(current) || isNaN(limitDD)) return;

            let pnlPercent = ((current - start) / start) * 100;
            
            // ELASTIC RATIO
            let ratio = limitDD / 10;

            let state, baseRisk, focus, cssClass;

            // ACCT CONDITION TRIGGERS (Scaled by ratio)
            const neutralTrigger = -0.99 * ratio;
            const resetTrigger = -3.5 * ratio;

            if (pnlPercent <= -limitDD) {
                state = "STOP"; baseRisk = 0; focus = "WALK AWAY"; cssClass = "stop-trading";
            } 
            else if (pnlPercent > 5.0) {
                state = "PEAK"; baseRisk = 1.5; focus = "Maximize Flow"; cssClass = "peak";
            } else if (pnlPercent > 2.5) {
                state = "FLOW"; baseRisk = 1.25; focus = "Push Rhythm"; cssClass = "flow";
            } else if (pnlPercent >= neutralTrigger) {
                state = "NEUTRAL"; baseRisk = 1.0; focus = "Presence"; cssClass = "neutral";
            } else if (pnlPercent >= resetTrigger) {
                state = "RESET"; baseRisk = 0.5; focus = "Re-center"; cssClass = "reset";
            } else {
                state = "LOCKDOWN"; baseRisk = 0.25; focus = "Survival Mode"; cssClass = "lockdown";
            }

            // Apply Elastic Risk
            let finalRiskPercent = baseRisk * ratio;
            let riskAmount = start * (finalRiskPercent / 100);

            const card = document.getElementById('result-card');
            card.style.display = 'block';
            card.className = cssClass;
            
            document.getElementById('stateText').innerText = state;
            document.getElementById('focusText').innerText = focus;
            document.getElementById('pnlText').innerText = pnlPercent.toFixed(2) + "%";
            document.getElementById('riskPerText').innerText = finalRiskPercent.toFixed(3) + "%";
            document.getElementById('riskAmtText').innerText = state === "STOP" ? "$0.00" : "$" + riskAmount.toLocaleString(undefined, {minimumFractionDigits: 2});
        }
    </script>
</body>
</html>
