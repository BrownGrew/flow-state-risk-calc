<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow State Risk Calc</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f0f;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        h2 { color: #555; letter-spacing: 2px; text-transform: uppercase; font-size: 14px; margin-bottom: 25px; }
        
        .input-group { width: 100%; max-width: 400px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-size: 12px; color: #888; font-weight: bold; }
        input {
            width: 100%;
            padding: 14px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            outline: none;
            box-sizing: border-box;
            transition: 0.3s;
        }
        input:focus { border-color: #00bcd4; background-color: #222; }
        
        button {
            width: 100%;
            max-width: 400px;
            padding: 16px;
            background-color: #00bcd4;
            color: #121212;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 10px;
            text-transform: uppercase;
        }

        #result-card {
            margin-top: 25px;
            width: 100%;
            max-width: 400px;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            display: none;
            box-sizing: border-box;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .state-label { font-size: 42px; font-weight: 900; margin: 0; line-height: 1; }
        .risk-label { font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 25px; margin-top: 10px; }
        
        .data-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; }
        .data-value { font-size: 18px; font-weight: bold; }

        #quote-display {
            width: 100%;
            max-width: 400px;
            margin-top: 25px;
            padding: 15px;
            background-color: #1a1a1a;
            border-radius: 10px;
            border-left: 4px solid #00bcd4;
            font-style: italic;
            font-size: 13px;
            color: #aaa;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        /* State Styles */
        .peak { background: linear-gradient(135deg, #198754, #146c43); }
        .flow { background: linear-gradient(135deg, #0dcaf0, #0aa2c0); }
        .neutral { background: #2c2c2c; }
        .reset { background: #ffc107; color: #000; }
        .reset .data-value, .reset .data-title, .reset .risk-label { color: #000; }
        .lockdown { background: #dc3545; }
        
        /* Stop Trading Style */
        .stop-trading { background: #000000; border: 4px solid #ff0000; animation: pulse-border 1.5s infinite; }
        .stop-trading .state-label { color: #ff0000; }

        @keyframes pulse-border {
            0% { border-color: #ff0000; box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4); }
            70% { border-color: #990000; box-shadow: 0 0 0 15px rgba(255, 0, 0, 0); }
            100% { border-color: #ff0000; box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
    </style>
</head>
<body>

    <h2>Flow State Manager</h2>

    <div class="input-group">
        <label>Starting Balance ($)</label>
        <input type="number" id="startBal" placeholder="100000">
    </div>

    <div class="input-group">
        <label>Current Balance ($)</label>
        <input type="number" id="currBal" placeholder="98500">
    </div>

    <div class="input-group">
        <label>Max Drawdown Limit (%)</label>
        <input type="number" id="maxDD" value="10" step="0.1">
    </div>

    <button onclick="calculateRisk()">Calculate Risk</button>

    <div id="result-card">
        <h1 id="stateText" class="state-label"></h1>
        <p id="focusText" class="risk-label"></p>

        <div class="data-row"><span class="data-title">Current PnL</span><span id="pnlText" class="data-value"></span></div>
        <div class="data-row"><span class="data-title">Risk Percent</span><span id="riskPerText" class="data-value"></span></div>
        <div class="data-row" style="border:none; margin-top: 10px;"><span class="data-title">Risk Amount</span><span id="riskAmtText" class="data-value" style="font-size: 28px; color: #fff;"></span></div>
    </div>

    <div id="quote-display"></div>

    <script>
        const quotes = [
            "Protecting capital is your only job.",
            "Trade the chart, not your emotions.",
            "The best trade is sometimes no trade.",
            "Discipline is doing what needs to be done.",
            "Markets reward those who survive."
        ];

        // Load saved values on startup
        window.onload = function() {
            if(localStorage.getItem('userMaxDD')) document.getElementById('maxDD').value = localStorage.getItem('userMaxDD');
            if(localStorage.getItem('userStartBal')) document.getElementById('startBal').value = localStorage.getItem('userStartBal');
        };

        function calculateRisk() {
            let start = parseFloat(document.getElementById('startBal').value);
            let current = parseFloat(document.getElementById('currBal').value);
            let limitDD = parseFloat(document.getElementById('maxDD').value);

            // Save Inputs
            localStorage.setItem('userMaxDD', limitDD);
            localStorage.setItem('userStartBal', start);

            if (isNaN(start) || isNaN(current) || isNaN(limitDD)) return;

            let pnlPercent = ((current - start) / start) * 100;
            let currentDD = Math.abs(pnlPercent);
            
            let state, riskPercent, focus, cssClass;

            // --- STOP TRADING LOGIC ---
            if (pnlPercent <= -limitDD) {
                state = "STOP"; 
                riskPercent = 0; 
                focus = "LIMIT REACHED - WALK AWAY"; 
                cssClass = "stop-trading";
            } 
            // --- REGULAR FLOW LOGIC ---
            else if (pnlPercent > 5.0) {
                state = "PEAK"; riskPercent = 1.5; focus = "Maximize Flow"; cssClass = "peak";
            } else if (pnlPercent > 2.5) {
                state = "FLOW"; riskPercent = 1.25; focus = "Push Rhythm"; cssClass = "flow";
            } else if (pnlPercent >= -0.49) {
                state = "NEUTRAL"; riskPercent = 1.0; focus = "Presence"; cssClass = "neutral";
            } else if (pnlPercent > -2.0) {
                state = "RESET"; riskPercent = 0.5; focus = "Re-center"; cssClass = "reset";
            } else {
                state = "LOCKDOWN"; riskPercent = 0.25; focus = "Capital Protection"; cssClass = "lockdown";
            }

            let riskAmount = current * (riskPercent / 100);

            // UI Update
            const card = document.getElementById('result-card');
            card.style.display = 'block';
            card.className = cssClass;
            
            document.getElementById('stateText').innerText = state;
            document.getElementById('focusText').innerText = focus;
            document.getElementById('pnlText').innerText = pnlPercent.toFixed(2) + "%";
            document.getElementById('riskPerText').innerText = riskPercent + "%";
            document.getElementById('riskAmtText').innerText = state === "STOP" ? "$0.00" : "$" + riskAmount.toLocaleString(undefined, {minimumFractionDigits: 2});

            // Quote display
            const qBox = document.getElementById('quote-display');
            qBox.innerText = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`;
            qBox.style.opacity = 1;
        }
    </script>
</body>
</html>
